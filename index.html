<!DOCTYPE html>
<html lang="sr">
<head>
    <meta charset="UTF-8">
    <title>Global Chat</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            background: #0f172a;
            color: #e5e7eb;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }

        .card {
            background: #020617;
            border-radius: 12px;
            box-shadow: 0 0 20px rgba(0,0,0,0.4);
            width: 100%;
            max-width: 500px;
            padding: 20px;
        }

        h1, h2 {
            text-align: center;
            margin-top: 0;
        }

        #welcome, #chat {
            display: none;
        }

        .field {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        input[type="text"] {
            flex: 1;
            padding: 8px 10px;
            border-radius: 6px;
            border: 1px solid #4b5563;
            background: #020617;
            color: #e5e7eb;
        }

        button {
            padding: 8px 14px;
            border-radius: 6px;
            border: none;
            cursor: pointer;
            background: #38bdf8;
            color: #020617;
            font-weight: bold;
        }

        button:hover {
            background: #0ea5e9;
        }

        #messages {
            margin-top: 15px;
            height: 260px;
            overflow-y: auto;
            border-radius: 8px;
            border: 1px solid #1f2937;
            padding: 10px;
            background: #020617;
            font-size: 14px;
        }

        .msg {
            margin-bottom: 6px;
            line-height: 1.3;
        }

        .msg .nick {
            font-weight: bold;
            color: #38bdf8;
        }

        .msg .time {
            font-size: 11px;
            color: #9ca3af;
            margin-left: 4px;
        }

        .system {
            text-align: center;
            font-size: 12px;
            color: #9ca3af;
            margin: 8px 0;
        }
    </style>
</head>
<body>
<div class="card">
    <div id="welcome">
        <h1>Dobrodošao u global chat</h1>
        <p>Unesi nickname i klikni OK.</p>
        <div class="field">
            <input type="text" id="nicknameInput" placeholder="Tvoj nickname">
            <button id="enterBtn">OK</button>
        </div>
    </div>

    <div id="chat">
        <h2 id="chatTitle">Global chat</h2>
        <div id="messages"></div>
        <div class="field">
            <input type="text" id="messageInput" placeholder="Napiši poruku i pritisni Enter ili Pošalji">
            <button id="sendBtn">Pošalji</button>
        </div>
    </div>
</div>

<!-- Firebase v8 SDK (lakše za početak) -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

<script>
    // TODO: OVDE UBACI SVOJ FIREBASE CONFIG
    // Kopiraš iz Firebase konzole (Project settings → Your apps → Web)
    var firebaseConfig = {
        apiKey: "AIzaSyAAt69CcHUgRTN2ZRT3tLkiNvSeEfI_EIY",
        authDomain: "global-chat-project-d4701.firebaseapp.com",
        databaseURL: "https://global-chat-project-d4701-default-rtdb.europe-west1.firebasedatabase.app",
        projectId: "global-chat-project-d4701",
        storageBucket: "global-chat-project-d4701.appspot.com",
        messagingSenderId: "1079106457634",
        appId: "1:1079106457634:web:4d8f3dff6c3ad5f3927a7b",
        measurementId: "G-0D9LPH17ZJ"
    };

    firebase.initializeApp(firebaseConfig);
    var db = firebase.database();
    var messagesRef = db.ref("messages");

    let nickname = null;

    const welcomeDiv = document.getElementById("welcome");
    const chatDiv = document.getElementById("chat");
    const nicknameInput = document.getElementById("nicknameInput");
    const enterBtn = document.getElementById("enterBtn");
    const chatTitle = document.getElementById("chatTitle");
    const messagesDiv = document.getElementById("messages");
    const messageInput = document.getElementById("messageInput");
    const sendBtn = document.getElementById("sendBtn");

    // Prikaži formu za nickname na početku
    welcomeDiv.style.display = "block";

    function enterChat() {
        let nick = nicknameInput.value.trim();
        if (!nick) {
            nick = "Guest" + Math.floor(Math.random() * 1000);
        }
        nickname = nick;
        chatTitle.textContent = "Global chat (" + nickname + ")";
        welcomeDiv.style.display = "none";
        chatDiv.style.display = "block";

        // Pošalji sistemsku poruku da je neko ušao (nije obavezno)
        messagesRef.push({
            nick: "SYSTEM",
            text: nickname + " se pridružio chatu",
            ts: Date.now(),
            system: true
        });
    }

    enterBtn.addEventListener("click", enterChat);
    nicknameInput.addEventListener("keyup", function (e) {
        if (e.key === "Enter") enterChat();
    });

    function sendMessage() {
        const text = messageInput.value.trim();
        if (!text || !nickname) return;

        messagesRef.push({
            nick: nickname,
            text: text,
            ts: Date.now(),
            system: false
        });

        messageInput.value = "";
    }

    sendBtn.addEventListener("click", sendMessage);
    messageInput.addEventListener("keyup", function (e) {
        if (e.key === "Enter") sendMessage();
    });

    function formatTime(ts) {
        const d = new Date(ts);
        const h = String(d.getHours()).padStart(2, "0");
        const m = String(d.getMinutes()).padStart(2, "0");
        return h + ":" + m;
    }

    // Slušanje poruka u realnom vremenu
    messagesRef.limitToLast(100).on("child_added", function (snapshot) {
        const msg = snapshot.val();
        const div = document.createElement("div");

        if (msg.system) {
            div.className = "system";
            div.textContent = msg.text + " [" + formatTime(msg.ts) + "]";
        } else {
            div.className = "msg";
            const nickSpan = document.createElement("span");
            nickSpan.className = "nick";
            nickSpan.textContent = msg.nick;

            const timeSpan = document.createElement("span");
            timeSpan.className = "time";
            timeSpan.textContent = "[" + formatTime(msg.ts) + "]";

            const textSpan = document.createElement("span");
            textSpan.textContent = ": " + msg.text;

            div.appendChild(nickSpan);
            div.appendChild(timeSpan);
            div.appendChild(textSpan);
        }

        messagesDiv.appendChild(div);
        messagesDiv.scrollTop = messagesDiv.scrollHeight;
    });
</script>
</body>
</html>


